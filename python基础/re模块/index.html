<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>15 正则表达式与re模块 - Python服务端入门与进阶指南</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "15 \u6b63\u5219\u8868\u8fbe\u5f0f\u4e0ere\u6a21\u5757";
    var mkdocs_page_input_path = "python\u57fa\u7840/re\u6a21\u5757.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Python服务端入门与进阶指南</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <span class="caption-text">Python重要操作与实践总结</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../重要操作/up/">01 Python需求与提高篇</a>
                </li>
                <li class="">
                    
    <a class="" href="../../重要操作/compile/">02 py源文件编译</a>
                </li>
                <li class="">
                    
    <a class="" href="../../typical_case/">03 重要操作总结</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Python常用数据类型汇集</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../list/">01 列表list</a>
                </li>
                <li class="">
                    
    <a class="" href="../dict/">02 字典dict</a>
                </li>
                <li class="">
                    
    <a class="" href="../tuple/">03 元组tuple</a>
                </li>
                <li class="">
                    
    <a class="" href="../字符串/">04 字符串str</a>
                </li>
                <li class="">
                    
    <a class="" href="../set/">05 集合set</a>
                </li>
                <li class="">
                    
    <a class="" href="../数字/">06 数字类型</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Python内置函数与常用模块介绍</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../内置函数/">01 常用内置函数</a>
                </li>
                <li class="">
                    
    <a class="" href="../异常/">02 异常处理</a>
                </li>
                <li class="">
                    
    <a class="" href="../os模块/">03 os模块</a>
                </li>
                <li class="">
                    
    <a class="" href="../sys模块/">04 sys模块</a>
                </li>
                <li class="">
                    
    <a class="" href="../time模块/">05 time模块</a>
                </li>
                <li class="">
                    
    <a class="" href="../序列化模块/">06 序列化模块</a>
                </li>
                <li class="">
                    
    <a class="" href="../string/">07 string模块</a>
                </li>
                <li class="">
                    
    <a class="" href="../random/">08 random模块</a>
                </li>
                <li class="">
                    
    <a class="" href="../logging/">09 logging模块</a>
                </li>
                <li class="">
                    
    <a class="" href="../optparse/">10 optparse模块</a>
                </li>
                <li class="">
                    
    <a class="" href="../datetime模块/">11 datetime与dateutil模块</a>
                </li>
                <li class="">
                    
    <a class="" href="../collections/">12 collections模块</a>
                </li>
                <li class="">
                    
    <a class="" href="../加密解密/">13 加密与解密模块</a>
                </li>
                <li class="">
                    
    <a class="" href="../configparser/">14 configparser模块</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">15 正则表达式与re模块</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#pythonre">正则表达式与Python中re模块的使用</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#_1">正则表达式</a></li>
        
            <li><a class="toctree-l4" href="#_7">常用的正则表达式小结</a></li>
        
            <li><a class="toctree-l4" href="#re">re模块</a></li>
        
            <li><a class="toctree-l4" href="#re_2">re有关的爬虫练习</a></li>
        
            <li><a class="toctree-l4" href="#_13">实际校验的一个例子</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../操作excel/">16 Python3操作Excel</a>
                </li>
                <li class="">
                    
    <a class="" href="../pymysql/">17 操作数据库pymysql模块</a>
                </li>
                <li class="">
                    
    <a class="" href="../SQLAlchemy/">18 操作数据库SQLAlchemy模块</a>
                </li>
                <li class="">
                    
    <a class="" href="../hmac/">19 校验客户端的合法性hmac模块</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Python进阶-面向对象-网编并发</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../python进阶/面向对象/">01 进阶知识点与面向对象整合</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python进阶/生成器/">02 迭代器与生成器</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python进阶/网编并发/">03 网络编程与并发编程</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python进阶/socket编程/">04 Python中原生socket的案例</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python进阶/并发编程提升/">05 Python并发编程提升篇</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python进阶/文件操作/">06 文件操作</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python进阶/with/">07 with上下文</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python进阶/闭包装饰器/">08 闭包与装饰器</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python进阶/描述符/">09 Python中的描述符</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python进阶/copy/">10 Python中的深拷贝与浅拷贝</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python进阶/asyncio/">11 Python协程基础</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python进阶/asyncio2/">12 Python协程详解与进阶</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python进阶/asyncio3/">13 asyncio并发编程进阶</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Python实现算法与数据结构</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../python进阶/算法数据结构/">01 python实现算法与数据结构</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">开发环境-中间件等工具</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../python进阶/缓存与redis/">01 缓存与redis</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python进阶/Github与虚拟环境/">02 Github与虚拟环境的使用</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python进阶/远程调试/">03 Pycharm连接远程代码</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python进阶/压测/">04 Mac/Linux压力测试神器Siege</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Linux服务端相关</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../python进阶/linux/">01 Linux服务端相关</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Python服务端入门与进阶指南</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Python内置函数与常用模块介绍 &raquo;</li>
        
      
    
    <li>15 正则表达式与re模块</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="pythonre">正则表达式与Python中re模块的使用</h1>
<p>爬虫中<code>正则表达式</code>使用的非常多，用Python做的话会用到<code>re模块</code>。
本文总结一下<code>正则表达式</code>与<code>re模块</code>的基础与使用。</p>
<p>另外，给大家介绍一个<code>在线测试正则表达式的神器网站</code>：<a href="http://tool.chinaz.com/regex">http://tool.chinaz.com/regex</a></p>
<h2 id="_1">正则表达式</h2>
<h3 id="_2">使用场景</h3>
<p>关于<code>正则表达式</code>的基本概念这里就不赘述了，大家可以去各种百科里查找它的定义。正则的<code>使用场景</code>主要分为两个：</p>
<pre><code>一是：检测某一段字符串是否符合规则，也就是我们常说的&quot;校验&quot;
二是：从一大段字符串中找到符合规则的字符串，可以理解为&quot;检索&quot;
</code></pre>

<p>对于第一种使用场景，我们在登陆或者注册时填写邮箱、手机号等内容的时候经常会见到——底层的实现思路就是利用正则“校验”我们输入的内容是否“规范”。
另外，正则的“检索”功能大量使用在<code>爬虫</code>里，简单的说，<code>爬虫</code>能从一个网站大量的数据中得到用户想要的内容等等......
需要特别注意，正则表达式只是用来处理字符串的</p>
<h3 id="_3">元字符</h3>
<h5 id="_4"><code>一：可以灵活使用的元字符：[] 与 [^]</code></h5>
<pre><code>（1）数字  [0-9]
（2）小写字母  [a-z]
（3）大写字母  [A-Z]
（4）大小写字母  [A-Za-z]
（5）大小写字母+数字  [0-9A-Za-z]
（6）注意一个字符组不限制个数：匹配三个的话：[0-9A-Za-z][0-9A-Za-z][0-9A-Za-z]
（7）大小写字母+ _与%   [A-Za-z_%]
（8-1）匹配1-5   [1\-5]  用转义符，- 有特殊含义
（8-2）字符组中 - 是有特殊意义的，需要使用\作为转义符！
（9）[^123]——除了123都匹配，包括换行
</code></pre>

<h5 id="_5"><code>二：匹配字符</code></h5>
<pre><code>（1）\d——所有数字
（2）\w——字母数字下划线
（3）\s——空白
（4）空格匹配空格
（5）\t——制表符
（6）\n——换行符
（7）\b——单词的边界   o\b——hello的'o'(o是单词的最后一个)    \bo——ok的'o'(o是单词的第一个)
（8）\W——除了字母数字下划线
（9）\D——除了数字
（10）\S——除了空白符
（11）.——匹配除了换行符所有的
（12）[\D\d]、[\W\w]、[\s\S]——匹配所有的
（13）[^123]——除了123都匹配，包括换行
（14）^——开始字符
（15）$——结束字符
（16）^.....$——开始+结尾，中间是5个除了换行的符号
（17）|——或   长的放在前面！
（18）()——分组   www\.(baidu|oldboy)\.com  匹配www.baidu.com或者www.oldboy.com
</code></pre>

<h3 id="_6">量词</h3>
<p>量词用来限制<code>匹配的次数</code></p>
<pre><code>（1）{n}——匹配n次
（2）{n,}——匹配至少n次
（3）{n,m}——匹配n到m次
（4）+——一次或者多次  匹配小数点的前后必须有数      \d+\.\d+
（5）*——0次或者多次    匹配整数：第一位是1-9不要是0：     [1-9]\d*|0
（6）?——0次或者一次    匹配一个整数或者小数： \d+(\.\d+)?
</code></pre>

<h2 id="_7">常用的正则表达式小结</h2>
<ul>
<li>'.'   默认匹配除\n之外任意一个字符，若指定flag DOTALL,则匹配任意字符，包括换行</li>
<li>'^'  匹配字符开头，若指定flags MULTILINE,这种也可以匹配上(r"^a","\nabc\neee",flags=re.MULTILINE)</li>
<li>'$'  匹配字符结尾，若指定：flags MULTILINE ,re.search('foo.$','foo1\nfoo2\n',re.MULTILINE).group() 会匹配到foo1</li>
<li>'*'  匹配<em>号前的字符0次或多次， re.search('a</em>','aaaabac')  结果'aaaa'</li>
<li>'+'  匹配前一个字符1次或多次，re.findall("ab+","ab+cd+abb+bba") 结果['ab', 'abb']</li>
<li>'?'   匹配前一个字符1次或0次 ,re.search('b?','alex').group() 匹配b 0次</li>
<li>'{m}' 匹配前一个字符m次 ,re.search('b{3}','alexbbbs').group()  匹配到'bbb'</li>
<li>'{n,m}' 匹配前一个字符n到m次，re.findall("ab{1,3}","abb abc abbcbbb") 结果'abb', 'ab', 'abb']</li>
<li>'|'  匹配|左或|右的字符，re.search("abc|ABC","ABCBabcCD").group() 结果'ABC'</li>
<li>'(...)' 分组匹配， re.search("(abc){2}a(123|45)", "abcabca456c").group() 结果为'abcabca45'</li>
<li>'\A'  只从字符开头匹配，re.search("\Aabc","alexabc") 是匹配不到的，相当于re.match('abc',"alexabc") 或^</li>
<li>'\Z'  匹配字符结尾，同$</li>
<li>'\d'  匹配数字0-9</li>
<li>'\D'  匹配非数字</li>
<li>'\w'  匹配[A-Za-z0-9]</li>
<li>'\W'  匹配非[A-Za-z0-9]</li>
<li>'\s'   匹配空白字符、\t、\n、\r , re.search("\s+","ab\tc1\n3").group() 结果 '\t'</li>
<li>(?P&lt;name&gt;...) 分组匹配 re.search("(?P&lt;province&gt;[0-9]{4})(?P&lt;city&gt;[0-9]{2})(?P&lt;birthday&gt;[0-9]{4})","371481199306143242").groupdict("city") 结果{'province': '3714', 'city': '81', 'birthday': '1993'}</li>
</ul>
<h3 id="_8">贪婪匹配与惰性匹配</h3>
<p>在正则中，默认的匹配模式是“贪婪匹配”，也就是说，<code>在符合匹配规则的前提下尽可能多的去匹配字符</code>，但是有些时候，我们不需要匹配太多的内容，只要得到需要的“片段”内容就好了。
而<code>量词</code>是匹配多次的，这时我们可以在量词的后面加上<code>?</code>就可以让匹配“适可而止”了，这样的匹配规则就是<code>惰性匹配</code>
这里举一个<code>贪婪匹配</code>与<code>惰性匹配</code>对比的例子：</p>
<pre><code>有字符串&quot;aasdasdasdxxxxxxasdasd&quot;，现在想匹配到x结束
（1）用&quot;惰性匹配&quot;的话：
    语法：a.*?x
    说明：遇见一个先检测是不是x，如果是的话就停止，不是的话就匹配
    结果：aasdasdasdx
（2）默认的&quot;贪婪匹配&quot;：
    语法：a.*x
    说明：这里会匹配后面所有的x
    结果：aasdasdasdxxxxxx
</code></pre>

<p>当然，什么时候用<code>贪婪匹配</code>什么时候用<code>惰性匹配</code>需要我们具体情况具体分析。</p>
<h2 id="re">re模块</h2>
<p><code>re模块</code>是Python的内置模块，是专门用来处理与正则表达式相关需求的模块。
使用方法：直接在Python程序中import即可：</p>
<pre><code>import re
</code></pre>

<p><strong>根据正则的规则从一段内容中查找结果</strong></p>
<h4 id="findall">findall</h4>
<p>找到所有符合正则规则的字符串，并以列表的形式返回结果：</p>
<pre><code>ret = re.findall('\d+','whw123w1233')
print(ret)
#结果：
['123', '1233']
</code></pre>

<h4 id="search">search</h4>
<p>找到第一个，返回<code>结果集</code>，需要通过group方法取值。没取到的话返回None，此时用group方法会报错！因此需要提前判断下：</p>
<pre><code>ret = re.search('\d+','wanghw123ww')
print(ret)
if ret:
    print(ret.group())
#结果：
&lt;_sre.SRE_Match object; span=(6, 9), match='123'&gt;
123
</code></pre>

<h4 id="match">match</h4>
<p>从头开始找第一个，返回一个结果集，需要通过group取值。没取到的话返回None，此时用group方法会报错！因此需要提前判断下：</p>
<p>下面是匹配到结果的：</p>
<pre><code>ret = re.match('\d+','23whw22a')
print(ret)
if ret:
    print(ret.group())
#结果：
&lt;_sre.SRE_Match object; span=(0, 2), match='23'&gt;
23
</code></pre>

<p>没有匹配到的话可以利用异常处理或者像上面一样的条件判断：</p>
<pre><code>ret = re.match('\d+','whw22a')
print(ret)
try:
    print(ret.group())
except AttributeError as e:
    print(e,':','没有匹配到！')
#结果：
None
'NoneType' object has no attribute 'group' : 没有匹配到！
</code></pre>

<p>我们可以看到，match的返回结果与search是一样的；而且，match的匹配语法其实就是相当于search在其匹配规则上加上<code>^</code>，因此：<code>match可以被search代替</code>，实际中match用的比较少。</p>
<pre><code>re.search('^\d+','123asd') 
等同于:
re.match('\d+','123asd')
</code></pre>

<p><strong>替换与切割</strong></p>
<h4 id="sub">sub</h4>
<p>我们可以利用re模块与正则表达式结合进行字符串的<code>批量替换:</code>
有如下需求：
字符串：s1 = 'wanghw123whw456'，将s1中所有的数字替换成字符串"HERO"。
我们可以利用re模块的sub方法来做：</p>
<pre><code>s1 = 'wanghw123whw456'
ss = re.sub('\d+','HERO',s1)
print(ss)
#结果：
wanghwHEROwhwHERO
</code></pre>

<p>sub方法的第一个参数是正则的规则，第二个参数是要被替换成的字符串，第三个参数是需要被操作的字符串。当然，聪明的你肯定想到一个问题：这默认替换的是所有符合规则的字符串呀！我如果想<code>限定替换的次数</code>怎么做呢？我们可以指定第四个参数，来达到限定替换次数的作用：</p>
<pre><code>s1 = 'wanghw123whw456'
ss = re.sub('\d+','HERO',s1,1)
print(ss)
#结果：
wanghwHEROwhw456
</code></pre>

<h4 id="subn">subn</h4>
<p>subn的用法跟sub一模一样，只不过<code>返回值</code>是有区别的，我们可以执行一下看看：</p>
<pre><code>s1 = 'wanghw123whw456'
ss = re.subn('\d+','HERO',s1)
print(ss)
#结果：
('wanghwHEROwhwHERO', 2)
</code></pre>

<p>当然也可以指定替换的次数：</p>
<pre><code>s1 = 'wanghw123whw456'
ss = re.subn('\d+','HERO',s1,1)
print(ss)
#结果：
('wanghwHEROwhw456', 1)
</code></pre>

<p>大家可以看到，subn方法返回一个元组：第一个元素是得到的结果，第二个元素是替换的次数。</p>
<h4 id="split">split</h4>
<p>split方法与字符串的切割方法一样，返回的也是一个列表，只不过，这次我们用的是<code>正则匹配的结果</code>进行切割的！</p>
<pre><code>s1 = 'wanghw123whw456qwe'
sq = re.split('\d+',s1)
print(sq)
#结果：
['wanghw', 'whw', 'qwe']
</code></pre>

<p>split的第一个参数放正则规则，第二个参数放被操作的字符串。</p>
<h4 id="_9">预编译</h4>
<p>我们都知道，Python是一种解释型的编程语言，Python的代码需要先在解释器中转换为机器码，最终转换为计算机能识别的编码才能运行。
对于正则匹配来说，如果一个同样的正则表达式需要用到几十次甚至上百次去匹配一段长文字的话，用普通的方法，我们需要将这个正则表达式运行几十次甚至上百次来进行每一次的匹配。这样大大的降低了我们程序的效率，是我们最不愿意看到的！
而在Python中为我们提供了<code>预编译</code>的方法去解决这个难题。
所谓的<code>预编译</code>，在正则中我们实际用在下面这样的场景中：对于一个经常被重复使用的正则表达式，我们可以先进行一次编译，<code>将这个正则表达式需要做的事预先编译</code>，这样，之后只要用到了这个表达式我们可以将<code>编译好的结果</code>直接拿来用就行了，酱紫大大的省了代码的执行时间！</p>
<h5 id="_10">预编译的使用举例：</h5>
<p>比如说，我们想匹配三段(实际中可能是上百个)用到相同规则匹配的字符串中的内容。首先，我们可以将这个规则进行预编译，然后利用这个预编译的结果去匹配每一段需要匹配的字符串：</p>
<pre><code>ss = 'wangh123qwe3123'
ss1 = 'wangh123qwe3123312'
ss2 = 'wangh123qwe3123qwqasd5412'

par = re.compile('\d+')
print(par)
rets = par.findall(ss)
rets1 = par.findall(ss1)
rets2 = par.findall(ss2)
print(rets)
print(rets1)
print(rets2)
</code></pre>

<p>看到这里，相信聪明的你又发现问题了！这样固然降低了<code>时间复杂度</code>，但是，如果实际中有几万个大字符串，你这样一下子读取出来，内存不是直接爆炸了么！
对！没错，针对降低<code>空间复杂度</code>的问题，Python为我们提供了另外一个方法————<code>finditer</code></p>
<h4 id="finditer">finditer</h4>
<p>需要注意的是，finditer方法得到的是一个<code>迭代器</code>。下面我们模拟匹配10个相同字符串的例子：</p>
<pre><code>re=  re.finditer('\d+','23adq9009qwe'*10)
print(re)
for i in re:
    print(i)
    print(i.group())
#结果(只拿一个结果举例)：
#第一个拿到的是re——迭代器对象
&lt;callable_iterator object at 0x000001157E942940&gt;
#遍历re中拿到的是&quot;结果集&quot;
&lt;_sre.SRE_Match object; span=(0, 2), match='23'&gt;
#最终的结果需要用group()方法取到：
23
</code></pre>

<p>下面就来一发<code>compile与finditer结合同时降低时间复杂度与空间复杂度的方法</code>：</p>
<pre><code>par = re.compile('\d+')
ret = par.finditer('wanghe123asdh2312asd33'*10)
print(ret)
for i in ret:
    print(i.group())
#结果(只拿前1组)：
&lt;callable_iterator object at 0x000001DA20362940&gt;
123
2312
33
</code></pre>

<h4 id="re_1">“分组”与re模块的结合使用</h4>
<p>在实际中，正则表达式的“分组”思想与re模块的方法结合使用的情况非常多</p>
<h4 id="findall_1">findall与分组</h4>
<p>有如下需求：在标签字符串中提取出标签中的内容：
一般的方法是这样的：</p>
<pre><code>s = '&lt;title&gt;whwHERO&lt;/title&gt;'
print(ret)
print(ret[0].split('&gt;'))
print(ret[0].split('&gt;')[1].split('&lt;')[0])
#结果：
['&gt;whwHERO&lt;']
['', 'whwHERO&lt;']
whwHERO
</code></pre>

<p>这样的方法看起来比较麻烦，正则匹配到以后我们还得用Python的方法去处理。
我们可以利用正则的<code>分组</code>与re模块的方法结合区实现：</p>
<pre><code>ret = re.findall('&gt;(\w+)&lt;',r'&lt;title&gt;whwHERO&lt;\\title&gt;')
print(ret)
#结果：
['whwHERO']
</code></pre>

<p>我们可以看到：<code>findall优先显示分组中的内容</code>！简直不要太棒！
这样的效果在本例中效果很棒，但是，在一下情况下我们是不想酱紫的：
如果我们想匹配www.baidu.com或者www.taobao.com。正则表达式利用分组我们可以酱紫写：<code>www\.(baidu|taobao)\.com</code>
但是，与findall方法结合会出现问题：</p>
<pre><code>ret = re.findall('www\.(baidu|taobao)\.com','www.baidu.com')
print(ret)
#结果：
['baidu']
</code></pre>

<p>再比如，我们想获取一串字符串中的数字(包括小数)：</p>
<pre><code>digit = re.findall('\d+(\.\d+)?',r'1.23+2.33')
print(digit)
#结果：['.23', '.33']
</code></pre>

<p>很显然，酱紫的<code>分组优先</code>是我们不想要的。那么如何取消findall下的分组优先呢？
在分组里的最前面加上<code>?:</code>就可以了，上面两个例子我们可以酱紫修改：</p>
<pre><code>ret = re.findall('www\.(?:baidu|taobao)\.com','www.baidu.com')
print(ret)
#结果：['www.baidu.com']
digit = re.findall('\d+(?:\.\d+)?','1.23+2.33')
print(digit)
#结果：
['1.23', '2.33']
</code></pre>

<h4 id="split_1">split与分组</h4>
<p>split与分组结合跟普通的split方法的区别是：与分组结合的话会保留在分组中“切掉”的内容，用一个例子来讲就很直观了：</p>
<pre><code>ret = re.split('\d(\d)','wanghw211whw222www233ee')
print(ret)
#结果：
['wanghw', '1', '1whw', '2', '2www', '3', '3ee']
</code></pre>

<p>我们可以看到：匹配的第二个数字在分组中，我们利用匹配到的两个数字进行切割，但是由于只有第二个数字在分组中，因此第一个数字被“干掉”了，切割后的列表只保留了第二个数字！</p>
<h4 id="search_1">search与分组</h4>
<p>在讲search与分组的关系时，请大家记住下面做数据处理的思想：</p>
<pre><code>在爬虫\数据清洗的过程中最常用的正则表达式的操作
而大多数时候我们并不是把我们要的内容都用正则写出来
而是把整个页面都用正则描述下来,然后把我需要的内容放在分组里
这样就能够通过分组取到我想要的内容了
</code></pre>

<p>(心中默念一遍后)看下面这个例子：
比如说我们从网页中爬取了下面字符串(当然实际中要大得多，这里只做模拟)</p>
<pre><code>s=&quot;&lt;title&gt;whwisahero&lt;\title&gt;&quot;
</code></pre>

<p>我们想用search方法获取里面的内容，根据上面介绍的<code>处理数据的思路</code>，我们先利用search拿到<code>结果集</code>，然后在这个结果集中取数据：</p>
<pre><code>ret = re.search(r'&lt;(\w+)&gt;(\w+)&lt;\\(\w+)&gt;',r'&lt;title&gt;whwisahero&lt;\title&gt;')
print(ret.group())
print(ret.group(0))
print(ret.group(1))
print(ret.group(2))
print(ret.group(3))
#结果：
&lt;title&gt;whwhwhw&lt;\title&gt;
&lt;title&gt;whwhwhw&lt;\title&gt;
title
whwisahero (这是我们想要的内容)
title
</code></pre>

<p>酱紫我们就拿到了结果。
但是，相信聪明的你叕叕叕叕叕发现问题了！<code>我怎么知道我想要的内容在哪个索引里！</code>没错！这里就需要我们利用<code>分组命名</code>了！</p>
<pre><code>ret = re.search('&lt;(?P&lt;title&gt;\w+)&gt;(?P&lt;content&gt;\w+)&lt;/(?P&lt;title2&gt;\w+)&gt;',r'&lt;title&gt;whwisahero&lt;/title&gt;')
print(ret.group('title'))
print(ret.group('title2'))
print(ret.group('content'))
#结果：
title
title
whwisahero
</code></pre>

<p>可以看到，我们在分组内部的前面利用<code>?P&lt;分组名&gt;</code>的语法为分组起了个名字，在最后取值的时候将分组名加在group方法的参数里就OK了！
另外，分组名还可以这么玩：
如果两个分组名一样可以酱紫写：</p>
<pre><code>ret1 = re.search('&lt;(?P&lt;title&gt;\w+)&gt;(?P&lt;content&gt;\w+)&lt;/(?P=title)&gt;',r'&lt;title&gt;whwisahero&lt;/title&gt;')
print(ret1.group('title'))
print(ret1.group('content'))
#结果：
title
whwisahero
</code></pre>

<p>也可以酱紫写：</p>
<pre><code>ret2 = re.search(r'&lt;(?P&lt;title&gt;\w+)&gt;(?P&lt;content&gt;\w+)&lt;/\1&gt;',r'&lt;title&gt;whwisahero&lt;/title&gt;')
print(ret2.group('title'))
print(ret2.group('content'))
#结果：
title
whwisahero
</code></pre>

<h4 id="_11">筛选数据的思想</h4>
<p>接着跟大家下筛选数据的思路：</p>
<pre><code>当我们要匹配的内容混在不想匹配的内容中
只能把不想要的也匹配出来,然后去掉不想要的就是想要的
</code></pre>

<p>看下面的例子：
我想拿到一串字符串中的正整数，利用上面的思路可以酱紫做：先将不需要的数据也匹配出来，然后进行进一步的加工。因为实际中正则表达式并不是万能或者一劳永逸的，得到的数据还需要我们进行进一步的处理：</p>
<pre><code>ret = re.findall('-*\d+\.\d+|(-*\d+)','2*(60+(-40.35/5)-(-4*3))')
print(ret)#['2', '60', '', '5', '-4', '3']
for i in ret:
    if not i or i.startswith('-'):
        ret.remove(i)
print(ret)#['2', '60', '5', '3']
</code></pre>

<h4 id="_12">常见的几个正则表达式例子：</h4>
<p>最后给大家分享常见的几个正则表达式：</p>
<pre><code>#邮箱的规则：
    （1）@之前必须有内容且只能是字母（大小写）、数字、下划线(_)、减号（-）、点（.）
    （2）@和最后一个点（.）之间必须有内容且只能是字母（大小写）、数字、点（.）、减号（-），且两个点不能挨着
    （3）最后一个点（.）之后必须有内容且内容只能是字母（大小写）、数字且长度为大于等于2个字节，小于等于6个字节
正则表达式：[\w\-\.]+@([a-zA-Z\d\-]+\.)+[a-zA-Z\d]{2,6}
</code></pre>

<pre><code>1.整数或者小数 包括正数和负数
-?\d+(\.\d+)?

2.年月日
2018-9-20
\d{1,4}-\d{1,2}-\d{1,2}
\d{1,4}-(1[0-2]|0?[1-9])-(3[01]|[12]\d|0?[1-9])

3.匹配qq号
4位 11位
[1-9]\d{4,11}

4.8-10位的密码 数字字母下划线
\w{8,10}

5.验证码
 [\da-zA-Z]{4}
</code></pre>

<h2 id="re_2">re有关的爬虫练习</h2>
<p><strong>简单版本</strong></p>
<pre><code class="python">import re
import json
from urllib.request import urlopen

def getPage(url):
    response = urlopen(url)
    return response.read().decode('utf-8')

def parsePage(s):
    com = re.compile(
        '&lt;div class=&quot;item&quot;&gt;.*?&lt;div class=&quot;pic&quot;&gt;.*?&lt;em .*?&gt;(?P&lt;id&gt;\d+).*?&lt;span class=&quot;title&quot;&gt;(?P&lt;title&gt;.*?)&lt;/span&gt;'
        '.*?&lt;span class=&quot;rating_num&quot; .*?&gt;(?P&lt;rating_num&gt;.*?)&lt;/span&gt;.*?&lt;span&gt;(?P&lt;comment_num&gt;.*?)评价&lt;/span&gt;', re.S)

    ret = com.finditer(s)
    for i in ret:
        yield {
            &quot;id&quot;: i.group(&quot;id&quot;),
            &quot;title&quot;: i.group(&quot;title&quot;),
            &quot;rating_num&quot;: i.group(&quot;rating_num&quot;),
            &quot;comment_num&quot;: i.group(&quot;comment_num&quot;),
        }


def main(num):
    url = 'https://movie.douban.com/top250?start=%s&amp;filter=' % num
    response_html = getPage(url)
    ret = parsePage(response_html)
    print(ret)
    f = open(&quot;move_info7&quot;, &quot;a&quot;, encoding=&quot;utf8&quot;)

    for obj in ret:
        print(obj)
        data = str(obj)
        f.write(data + &quot;\n&quot;)

count = 0
for i in range(10):
    main(count)
    count += 25
</code></pre>

<p><strong>优化版</strong></p>
<pre><code class="python">import requests

import re
import json


def getPage(url):
    response = requests.get(url)
    return response.text


def parsePage(s):
    com = re.compile(
        '&lt;div class=&quot;item&quot;&gt;.*?&lt;div class=&quot;pic&quot;&gt;.*?&lt;em .*?&gt;(?P&lt;id&gt;\d+).*?&lt;span class=&quot;title&quot;&gt;(?P&lt;title&gt;.*?)&lt;/span&gt;'
        '.*?&lt;span class=&quot;rating_num&quot; .*?&gt;(?P&lt;rating_num&gt;.*?)&lt;/span&gt;.*?&lt;span&gt;(?P&lt;comment_num&gt;.*?)评价&lt;/span&gt;', re.S)

    ret = com.finditer(s)
    for i in ret:
        yield {
            &quot;id&quot;: i.group(&quot;id&quot;),
            &quot;title&quot;: i.group(&quot;title&quot;),
            &quot;rating_num&quot;: i.group(&quot;rating_num&quot;),
            &quot;comment_num&quot;: i.group(&quot;comment_num&quot;),
        }


def main(num):
    url = 'https://movie.douban.com/top250?start=%s&amp;filter=' % num
    response_html = getPage(url)
    ret = parsePage(response_html)
    print(ret)
    f = open(&quot;move_info7&quot;, &quot;a&quot;, encoding=&quot;utf8&quot;)

    for obj in ret:
        print(obj)
        data = json.dumps(obj, ensure_ascii=False)
        f.write(data + &quot;\n&quot;)


if __name__ == '__main__':
    count = 0
    for i in range(10):
        main(count)
        count += 25
</code></pre>

<h2 id="_13">实际校验的一个例子</h2>
<p><a href="https://www.cnblogs.com/paulwhw/articles/12431076.html">校验密码:长度再8~24之间并且包含大小写字母数字特殊字符中的至少三种</a></p>
<p><strong>自己练习的例子</strong></p>
<p><a href="https://www.cnblogs.com/paulwhw/p/8728786.html">re模块小结</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../操作excel/" class="btn btn-neutral float-right" title="16 Python3操作Excel">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../configparser/" class="btn btn-neutral" title="14 configparser模块"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../configparser/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../操作excel/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
